### chapter 2
N张输入图像和一个所有图像都可以看到的3D点p,任意一对图像I<sub>i</sub>和I<sub>j</sub>关于点p的图像一致性 表示如下:

![avatar](./mvs_pic/consistency_pic.png)

式中:
p: 3D点;
 πi(p): 点p在图像i中的投影;
Ω(x):点x附近的邻域;
Ii(x): 在区域Ω内的图像强度 
ρ(f, g):两个vector之间的相似性测量;

图像一致性可以通过ρ和Ω的选择来确定.

一些图像一致性不需要邻域Ω一些需要, 邻域的主要作用是确定一块场景的区域是唯一的与场景和视角无关.唯一性和不相关性在图像一致性中经常互斥,邻域越大,图像唯一性的可能就越大,与其它图像的越容易匹配,同时邻域越大,由于变形,深度限制和平滑吉和假设(例如:平面假设)越难维持照明和视口不相关.

MVS算法中, 定义邻域的简单方法是:用一个固定大小的正方形像素网格，当输入图像与正在重建的表面共享大致相同的像素分辨率时这种方法很有效, eg,使用 3x3或者5x5的像素大小, 在更复杂的场景,图像的分辨率不一致,场景位置不是均匀分布的, 调整邻域的大小非常困难, 尺寸需要成比例
相反，图像分辨率和视点分离与场景的距离成正比。 有些方法甚至会改变邻域的形状，其中一个特别成功的实例
视图相关域是通过将域Ω计算为投影以3D点p为中心的3D局部区块 [210, 74],其他方法显着增加图像的密度，
这可以实现更小的域大小，极端情况是使用视频[145]或光场[195,117]

该领域相关的 概念非常相近的是概念是图像一致性聚合[162]，其中包括
在空间上聚合照片一致性测量以增加其鲁棒性。当在没有域的情况下计算的度量一起使用时它是最有效的, 例如 差分平方和Sum of Square Differences (SSD)和 差分绝对值和 Sum of Absolute Differences (SAD)由于先进的聚合技术能在不需要平滑的情况下使用(详见2.1.8).

图像一致性的定义见式2.1, 点的图像一致性可以定义如下,通过对单个图像相关的所有图像对的图像一致性求平均

![avatar](./mvs_pic/consistency_pic.png)

及对所有图相对的图像一致性求平均.

![avatar](./mvs_pic/consistency_pic.png)

如上所述:图像一致性的定义要求所有图像包含给定点,就是说必须已知图像包含给定点.接下来描述一些常用的图像一致性测量方法,详细信息见[99], 通过比较f和g两个vector计算 图像一致性, f,g可以通过采样灰度图的矩形区域来获取如图2-1所示;

![avatar](./mvs_pic/consistency_pic.png)

对于彩色图像,操作如下:
1.计算图像一致性之前将彩色图转为灰度图
2.对rgb通道,每个通道单独计算图像一致性,求平均
3.将,每个通道的vector合并成大的vector

简要说明下对于有无纹理的表面不同的测量方式如图2-2, 图2-3表示随着点沿着对极线移动时的图像一致性曲线,


2.1.1 Normalized Cross Correlation(归一化交叉相关性)
zero-mean NCC 是多视觉立体几何中最常用的一致性测量算法之一, 算法图像增益与偏差无关,并且与材质和光照无关条件下使用例如计算
收集的图像光照和材质相差很多的情况下使用,NCC算法的缺点是缺少表面纹理和重复纹理,计算精度高.计算公式如下

![avatar](./mvs_pic/consistency_pic.png)

f 均值 σ标准差 f

对于彩色图像,将所有颜色简单的集中到一个vector应用上述公式中的效果不佳,在复杂情况下例如均匀纹理表面,主要视觉线索通常是其表面的细微阴影和阴影效果我们想要
NCC捕捉每个颜色通道中细微的空间强度变化，比颜色的强度变化小得多渠道。通过简单的连接，NCC只需要捕获不同颜色通道的强度变化。更好的解决方案
是独立计算每个颜色通道的NCC并返回NCC平均得分。更复杂的方法是计算和单独减去每个颜色通道的平均强度（’f和G’），但将所有颜色通道作为单个向量连接在一起计算其方差时（σf和σg）。这允许NCC捕获
每个颜色通道中的空间强度变化，同时降低权重具有较小强度变化的颜色通道。

2.1.2  Sum of Squared Differences(平方差求和) SSD

2.1.3 Sum of Absolute Differences(差分绝对值)


2.1.4 Census 统计方法

2.1.5 Rank 

2.1.6 Mutual information 互信息

2.1.7 interval comparison间隔对比


*** Photo-consistency normalization ***

以上方法中的图像一致性测量方法很少作为MVS方法的最后阶段应用；相反，经常通过非线性操作转化用于以下目的：i>不同的图像一致性值归一化到同样的范围区间；II>将原始的图像一致性转化到“几何似然”，归一化对参数优化同结合图像一致性计算一样重要，或者其他因素。典型的转换包括：指数函数、线性截断函数、平滑函数，如图2.5；归一化函数就像一个黑箱，将图像一致性值转化成几何似然测量值，i.e.描述了它可能是3D几何的概率范围。

![fig2.5](mvs_pic/fig2-5.PNG)

上图中三个对应的函数分别为：
1>.
2>.
3>.

以上三个归一化函数中，指数函数理论上来讲是最合理的，也是最常用的。如果是高斯噪声函数并且没有外点，对SSD来说是最佳的函数。然而纯高斯噪声是不现实的，这就是为什么通常会优先选用SAD而不是SSD方法。
当考虑到图形一致性的内外点噪声模型时，归一化函数的形状期望是sigmoid形状的，有两个平缓的变化，中间是相对倾斜的变化量。如图2.5所示。其中的原理是：陡坡被认为是区分内外点的阈值。例如SAD方法中，典型的内点误差小于5级（共255级），典型的外点值高于10级，一旦SAD值高于10级，无论是20还是30，都会对应一个很低的几何似然值，相同的NCC值低于1/1.414的都会被认为不够精确会被丢弃。

***2.1.8 Photo-consistency aggregation(集合/聚集)***
图像一致性是一种带噪声的测量方式，并且再用来计算3D几何之前需要滤波操作。滤波操作的独立于计算一致性时候的作用域，作用域可以看成是一个集合，滤波操作通常不需要作用域例如SAD,有时间限制的算法，以及局部优化方法代替全局优化方法例如图割算法。



***2.1.9 Photo-consistency representation()***
最基础的滤波操作就是在局部域求平均值，例如一个固定大小的方块。 SAD方法中
***2.1.10 Popular choices***


### **chapter 3 基于图像一致性的三维重建**

基于第二章的图像一致性算法，本章将会详细介绍最近几年流行的多视角立体几何算法。区分MVS算法有许多因素，例如图像一致性函数，场景表达，可视化计算和初始化条件。因此提出一个单独的分类并不容易。本文将会依据输出的场景表示方法作为主要分类方式。因为它决定了应用的场景，有兴趣的读者可以参考[165]查看mvs算法的分类方法。
Fig3.1 表示4种常用的表示方法：深度图、点云、体素场、mesh面片，每个重建算法的state-of-the-art 方法介绍。点云重建方法的渲染方式是采用基于点的渲染技术[160,83],展示了一个完整的纹理渲染模型，但是点云模型仅仅是独立的带颜色的3D点；体素场常用于计算机视觉和计算机图形学表示3D平面，常将体素场当成距离一个平面的带符号的距离函数，该平面是函数场的零势面。
Fig3.2表示MVS算法的重建步骤和中间或者最终几何形态类型，许多MVS算法集中于单个重建步骤，然而有些将多个步骤组合成操作管线，本表表达了大多数MVS算法/系统，除了一种算法-直接通过图像一致性体素构建mesh，通过体素融合方法[190，102]，再这个方法中，图像一致性体素替换了点云图或者深度图。
当然有许多过去开发的算法再这里没有列举出来，例如level-set方法，level-set曾经在MVS算法中非常流行，因为它能处理拓扑结构的变化[58]，典型的重建步骤是初始化模型然后进行优化，拓扑结构的初始化可能是不正确的，然而level-set不再被使用因为更好的初始化或者重建算法（见本章）已经被开发出来。高质量的模型和正确的拓扑结构能够直接通过图像一致性获取，因此就不需要优化过程。同样的早些时候许多算法基于visual hull初始化mesh形态，然而最新也不再使用，因为形状的提取过程通常需要人工手动提取，visual hull 不再是有效的近似或者对于有许多凹面的结构情况不再有效，更好的初始化重建技术发展也加速就有方法的淘汰。[注全自动的形态提取方法见47，49，50]。

####3D表达和应用

###3.1深度图重建

####3.1.1 winner-takes-all depthmaps

####3.1.2 Robust Photo-Consistency Depthmaps

####3.1.3 MRF Depthmaps

####3.1.4 Multiple Hypothesis MRF Depthmaps

####3.1.5 More Depthmap Reconstruction Algorithms


###3.2 Point-cloud Reconstruction


###3.3 Volumetric data fusion


###3.4 MVS Mesh Refinement





















